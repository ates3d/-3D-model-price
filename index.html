<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
<title>Ates3d Fiyat Hesaplama</title>

<style>
:root {
    --primary: #f04e23; /* Logonun turuncu tonu */
    --primary-hover: #d13d1a;
    --bg: #f8fafc; --card-bg: #ffffff;
    --text: #1e293b; --border: #e2e8f0;
}
.dark {
    --bg: #0f172a; --card-bg: #1e293b;
    --text: #f1f5f9; --border: #334155;
}

*{box-sizing:border-box; -webkit-tap-highlight-color: transparent}
body{font-family: 'Inter', system-ui, -apple-system, sans-serif; background: var(--bg); color: var(--text); margin:0; padding:10px; transition: background 0.3s}

.card{max-width:800px; margin:10px auto; background: var(--card-bg); padding:24px; border-radius:20px; box-shadow: 0 10px 25px -5px rgba(0,0,0,0.1); border: 1px solid var(--border)}

/* LOGO ALANI */
.logo-container { text-align: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid var(--border); }
.logo-container img { max-width: 220px; height: auto; border-radius: 10px; }

.topBar{display:flex; justify-content:flex-end; align-items:center; margin-bottom:20px; gap:15px}
.toggleWrap{display:flex; align-items:center; cursor:pointer; background: var(--border); padding:5px 10px; border-radius:20px}

.langSwitch{font-weight:700; font-size:14px; background: var(--border); padding:5px 12px; border-radius:20px}
.langSwitch span{cursor:pointer; opacity:.4; transition: 0.2s}
.langSwitch span.active{opacity:1; color: var(--primary)}

.tabs{display:flex; gap:8px; margin-bottom:25px; background: var(--border); padding:4px; border-radius:12px}
.tab{flex:1; text-align:center; padding:10px; border-radius:8px; cursor:pointer; font-weight:600; transition: 0.2s; font-size: 14px}
.tab.active{background: var(--card-bg); color: var(--primary); box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1)}

label{font-size:13px; font-weight:600; margin-bottom:6px; display:flex; align-items:center; gap:6px; color: #64748b}
.save-tick{color:#10b981; opacity:0; font-size:16px; transition: 0.3s}
.save-tick.show{opacity:1}

input, select{
    width:100%; padding:12px; border-radius:10px; border: 1px solid var(--border); 
    background: var(--bg); color: var(--text); font-size:16px; transition: all 0.2s;
}
input:focus{border-color: var(--primary); outline:none; ring: 2px var(--primary)}

/* HATA DURUMU STÄ°LÄ° */
.input-error {
    border-color: #ef4444 !important;
    background-color: rgba(239, 68, 68, 0.05) !important;
    animation: shake 0.4s ease-in-out;
}
@keyframes shake {
    0%, 100% { transform: translateX(0); }
    25% { transform: translateX(-5px); }
    75% { transform: translateX(5px); }
}

.modelRow{
    display:grid; grid-template-columns: 1fr 1fr 1fr auto; gap:12px; 
    margin-bottom:15px; padding:15px; background: rgba(0,0,0,0.02); border-radius:12px;
}
@media (max-width: 600px) {
    .modelRow { grid-template-columns: 1fr 1fr; }
    .modelRow button { grid-column: span 2; margin-top: 5px; }
}

.settingRow{margin-bottom:20px}
h2{font-size: 18px; margin: 25px 0 15px 0; border-left: 4px solid var(--primary); padding-left: 10px}

button{
    padding:14px 20px; border:0; border-radius:12px; font-weight:700; 
    cursor:pointer; transition: all 0.2s; width: 100%; margin-top: 10px;
}
button:active{transform: scale(0.98)}
.blue{background: var(--primary); color: #fff}
.green{background: #10b981; color: #fff; font-size: 18px}
.danger{background: #ef4444; color: #fff}

.result{
    margin-top:30px; padding:25px; border-radius:16px; font-size:22px; 
    text-align:center; animation: slideUp 0.4s ease-out; display:none;
}
.result.ok{background: linear-gradient(135deg, #f04e23, #fb923c); color:#fff; box-shadow: 0 10px 20px rgba(240, 78, 35, 0.3)}

@keyframes slideUp { from {opacity:0; transform: translateY(20px)} to {opacity:1; transform: translateY(0)} }
</style>
</head>

<body>
<div class="card">
    <div class="logo-container">
        <img src="logo.png" alt="AteÅŸ 3D Logo">
    </div>

    <div class="topBar">
        <div class="toggleWrap" onclick="toggleDark()">
            <span id="darkIcon">ðŸŒ™</span>
        </div>
        <div class="langSwitch">
            <span id="langTR" onclick="setLang('tr')">TR</span><span style="margin:0 5px; opacity:0.3">|</span><span id="langEN" onclick="setLang('en')">EN</span>
        </div>
    </div>

    <div class="tabs">
        <div id="tabMain" class="tab active" onclick="showPage('main')" data-i="mainTab"></div>
        <div id="tabSettings" class="tab" onclick="showPage('settings')" data-i="settingsTab"></div>
    </div>

    <div id="main">
        <label><span data-i="filament"></span> <span class="save-tick">âœ“</span></label>
        <select id="filamentSelect" onchange="calculate()"></select>

        <h2 data-i="modelInfo"></h2>
        <div id="models"></div>

        <button class="blue" onclick="addModel()" style="background:rgba(240, 78, 35, 0.1); color:var(--primary); margin-bottom:10px" data-i="addModel"></button>

        <div class="settingRow">
            <label><span data-i="laborTime"></span> <span class="save-tick">âœ“</span></label>
            <input id="laborTime" type="number" placeholder="0">
        </div>

        <button class="green" onclick="calculate()" data-i="calculate"></button>
        <div id="resultMain" class="result"></div>
    </div>

    <div id="settings" style="display:none">
        <h2 data-i="filamentMgmt"></h2>
        <div class="modelRow" style="background:none; padding:0">
            <div><label data-i="filamentName"></label><input id="newFilName"></div>
            <div><label><span data-i="priceKg"></span></label><input id="newFilPrice" type="number"></div>
            <button class="blue" onclick="addFilament()" data-i="add" style="margin-top:25px"></button>
        </div>
        <div id="filamentList"></div>

        <h2 data-i="costs"></h2>
        <div class="settingRow">
            <label data-i="currencyLabel"></label>
            <select id="currencySelect" onchange="updateCurrency(this.value)">
                <option value="TL">TRY (â‚º)</option>
                <option value="USD">USD ($)</option>
                <option value="EUR">EUR (â‚¬)</option>
            </select>
        </div>
        <div class="settingRow"><label><span data-i="printerW"></span> <span class="save-tick">âœ“</span></label><input id="printerW" type="number"></div>
        <div class="settingRow"><label><span data-i="elec"></span> (<span class="currSym"></span>/kWh) <span class="save-tick">âœ“</span></label><input id="elecPrice" type="number" step="0.01"></div>
        <div class="settingRow"><label><span data-i="laborRate"></span> (<span class="currSym"></span>) <span class="save-tick">âœ“</span></label><input id="laborRate" type="number"></div>
        <div class="settingRow"><label><span data-i="machinePrice"></span> (<span class="currSym"></span>) <span class="save-tick">âœ“</span></label><input id="machinePrice" type="number"></div>
        <div class="settingRow"><label><span data-i="machineLife"></span> <span class="save-tick">âœ“</span></label><input id="machineLife" type="number"></div>
        <div class="settingRow"><label><span data-i="profit"></span> <span class="save-tick">âœ“</span></label><input id="profitPct" type="number"></div>
        <div class="settingRow"><label><span data-i="waste"></span> <span class="save-tick">âœ“</span></label><input id="wastePct" type="number"></div>
        
        <h2 data-i="shippingAndPack"></h2>
        <div class="settingRow"><label><span data-i="packCost"></span> (<span class="currSym"></span>) <span class="save-tick">âœ“</span></label><input id="packCost" type="number"></div>
        <div class="settingRow"><label><span data-i="shipCost"></span> (<span class="currSym"></span>) <span class="save-tick">âœ“</span></label><input id="shipCost" type="number"></div>
    </div>
</div>

<script>
const $=id=>document.getElementById(id)
let state = JSON.parse(localStorage.getItem('calc') || '{"filaments":[], "models":[{}], "dark":false, "lang":"tr", "currency":"TL"}')

const symbols = { 'TL': 'â‚º', 'USD': '$', 'EUR': 'â‚¬' }
const dict = {
    tr: {
        mainTab:'Hesapla', settingsTab:'Ayarlar', filament:'Filament Tipi',
        modelInfo:'BaskÄ± DetaylarÄ±', addModel:'+ Yeni ParÃ§a Ekle', calculate:'FiyatÄ± Hesapla',
        laborTime:'HazÄ±rlÄ±k SÃ¼resi (dk)', filamentMgmt:'Filamentlerin', filamentName:'AdÄ±',
        priceKg:'Kg FiyatÄ±', add:'Ekle', costs:'Sabit Maliyetler', currencyLabel:'Para Birimi',
        printerW:'YazÄ±cÄ± GÃ¼cÃ¼ (W)', elec:'Elektrik Birim FiyatÄ±', laborRate:'Saatlik Ä°ÅŸÃ§ilik',
        machinePrice:'Makine FiyatÄ±', machineLife:'Ã–mÃ¼r (saat)', profit:'KÃ¢r OranÄ± (%)',
        waste:'Fire (%)', shippingAndPack:'Lojistik', packCost:'Paketleme', shipCost:'Kargo',
        err:'Eksik bilgi var!', lblGram:'Gram', lblTime:'SÃ¼re (dk)', lblQty:'Adet', lblTotal:'TOPLAM TUTAR',
        errFil:'LÃ¼tfen Ã¶nce ayarlar sayfasÄ±ndan bir filament ekleyin!',
        errSet:'LÃ¼tfen ayarlar sayfasÄ±ndaki maliyet bilgilerini eksiksiz doldurun!'
    },
    en: {
        mainTab:'Calculate', settingsTab:'Settings', filament:'Filament Type',
        modelInfo:'Print Details', addModel:'+ Add New Part', calculate:'Calculate Price',
        laborTime:'Setup Time (min)', filamentMgmt:'Filaments', filamentName:'Name',
        priceKg:'Price/Kg', add:'Add', costs:'Fixed Costs', currencyLabel:'Currency',
        printerW:'Printer Watts', elec:'Elec. Price', laborRate:'Hourly Labor',
        machinePrice:'Machine Price', machineLife:'Life (hrs)', profit:'Profit (%)',
        waste:'Waste (%)', shippingAndPack:'Logistics', packCost:'Packaging', shipCost:'Shipping',
        err:'Missing info!', lblGram:'Grams', lblTime:'Min', lblQty:'Qty', lblTotal:'TOTAL PRICE',
        errFil:'Please add a filament in settings first!',
        errSet:'Please fill in the cost details in settings!'
    }
}

function save(e) {
    localStorage.setItem('calc', JSON.stringify(state));
    if (e && e.target) {
        const label = e.target.closest('div')?.querySelector('.save-tick') || e.target.closest('.settingRow')?.querySelector('.save-tick');
        if (label) { label.classList.add('show'); setTimeout(()=>label.classList.remove('show'), 1000); }
    }
}

function toggleDark() {
    state.dark = !state.dark;
    document.documentElement.classList.toggle('dark', state.dark);
    $('darkIcon').textContent = state.dark ? 'â˜€ï¸' : 'ðŸŒ™';
    save();
}

function setLang(l) {
    state.lang = l;
    applyLang();
    save();
}

function applyLang() {
    document.querySelectorAll('[data-i]').forEach(el => el.textContent = dict[state.lang][el.dataset.i]);
    $('langTR').classList.toggle('active', state.lang==='tr');
    $('langEN').classList.toggle('active', state.lang==='en');
    updateCurrencyDisplay();
}

function updateCurrency(v) { state.currency = v; updateCurrencyDisplay(); save(); }
function updateCurrencyDisplay() {
    document.querySelectorAll('.currSym').forEach(el => el.textContent = symbols[state.currency]);
    renderFilaments();
}

function showPage(p) {
    $('main').style.display = p==='main' ? 'block' : 'none';
    $('settings').style.display = p==='settings' ? 'block' : 'none';
    $('tabMain').classList.toggle('active', p==='main');
    $('tabSettings').classList.toggle('active', p==='settings');
}

function addModel(m={}) {
    const d = document.createElement('div');
    d.className = 'modelRow';
    d.innerHTML = `
        <div><label><span data-i="lblGram"></span></label><input class="gram" type="number" value="${m.g||''}" oninput="saveModels()"></div>
        <div><label><span data-i="lblTime"></span></label><input class="minute" type="number" value="${m.m||''}" oninput="saveModels()"></div>
        <div><label><span data-i="lblQty"></span></label><input class="qty" type="number" value="${m.q||1}" oninput="saveModels()"></div>
        <button class="danger" onclick="this.parentNode.remove();saveModels()">âœ•</button>`;
    $('models').appendChild(d);
    applyLang();
}

function saveModels() {
    state.models = Array.from(document.querySelectorAll('#models .modelRow')).map(r => ({
        g: r.querySelector('.gram').value, m: r.querySelector('.minute').value, q: r.querySelector('.qty').value || 1
    }));
    state.laborTime = +$('laborTime').value || 0;
    save();
}

function renderFilaments() {
    $('filamentSelect').innerHTML = state.filaments.map((f,i)=>`<option value="${i}">${f.name} (${f.price} ${symbols[state.currency]})</option>`).join('');
    $('filamentList').innerHTML = state.filaments.map((f,i)=>`
        <div class="modelRow" style="grid-template-columns: 1fr 1fr auto; align-items:center">
            <div style="font-weight:600">${f.name}</div><div>${f.price} ${symbols[state.currency]}</div>
            <button class="danger" onclick="delFil(${i})" style="padding:8px">âœ•</button>
        </div>`).join('');
}

function addFilament() {
    if (!$('newFilName').value || !$('newFilPrice').value) return;
    state.filaments.push({name: $('newFilName').value, price: +$('newFilPrice').value});
    $('newFilName').value = $('newFilPrice').value = '';
    save(); renderFilaments();
}
function delFil(i) { state.filaments.splice(i,1); save(); renderFilaments(); }

function calculate() {
    saveModels();
    document.querySelectorAll('input, select').forEach(el => el.classList.remove('input-error'));
    
    let firstErrorEl = null;
    const check = (id) => {
        const el = $(id);
        if (!el.value || el.value < 0) {
            el.classList.add('input-error');
            if (!firstErrorEl) firstErrorEl = el;
            return false;
        }
        return true;
    };

    const req = ['printerW', 'elecPrice', 'machinePrice', 'machineLife'];
    let settingsOk = true;
    req.forEach(id => { if (!check(id)) settingsOk = false; });

    let modelsOk = true;
    document.querySelectorAll('#models .modelRow').forEach(r => {
        const g = r.querySelector('.gram'), m = r.querySelector('.minute');
        if (!g.value || g.value <= 0) { g.classList.add('input-error'); if(!firstErrorEl) firstErrorEl=g; modelsOk=false; }
        if (!m.value || m.value <= 0) { m.classList.add('input-error'); if(!firstErrorEl) firstErrorEl=m; modelsOk=false; }
    });

    if (!state.filaments.length) { alert(dict[state.lang].errFil); showPage('settings'); return; }

    if (!settingsOk || !modelsOk) {
        if (!settingsOk && $('main').style.display !== 'none') { alert(dict[state.lang].errSet); showPage('settings'); }
        if (firstErrorEl) { firstErrorEl.focus(); firstErrorEl.scrollIntoView({ behavior: 'smooth', block: 'center' }); }
        return;
    }

    const fil = state.filaments[$('filamentSelect').value];
    let tg=0, th=0;
    state.models.forEach(m => { tg += m.g * m.q; th += (m.m / 60) * m.q; });

    const fCost = (tg/1000)*fil.price*(1+state.wastePct/100);
    const eCost = (state.printerW/1000)*th*state.elecPrice;
    const lCost = (state.laborTime/60)*state.laborRate;
    const dep = (state.machinePrice/state.machineLife)*th;
    const total = (fCost + eCost + lCost + dep) * (1+state.profitPct/100) + (state.packCost||0) + (state.shipCost||0);

    $('resultMain').innerHTML = `<small>${dict[state.lang].lblTotal}</small><br><strong>${total.toFixed(2)} ${symbols[state.currency]}</strong>`;
    $('resultMain').style.display = 'block';
    $('resultMain').className = 'result ok';
}

// BaÅŸlat
document.documentElement.classList.toggle('dark', state.dark);
$('darkIcon').textContent = state.dark ? 'â˜€ï¸' : 'ðŸŒ™';
['printerW','elecPrice','laborRate','machinePrice','machineLife','profitPct','wastePct','packCost','shipCost'].forEach(id => {
    $(id).value = state[id] || '';
    $(id).oninput = e => { state[id] = +e.target.value; save(e); };
});
$('laborTime').value = state.laborTime || '';
$('laborTime').oninput = e => saveModels();
if(state.models.length) state.models.forEach(m => addModel(m)); else addModel();
applyLang(); renderFilaments();
</script>
</body>
</html>
